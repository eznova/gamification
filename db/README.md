### README.md

# База данных для управления пользователями

Эта база данных предназначена для хранения информации о пользователях, их ролях, должностях, отделах, а также дополнительных данных, таких как интересы, рейтинги, фото и др.

---

## Структура базы данных

База данных состоит из следующих таблиц:

### Основные таблицы:

1. **`users`**  
   Хранит основную информацию о пользователях.  
   Поля:  
   - `id` — уникальный идентификатор пользователя (primary key).  
   - `login` — логин пользователя (уникальный).  
   - `password` — хэшированный пароль.  
   - `name` — имя.  
   - `patronymic` — отчество.  
   - `surname` — фамилия.  
   - `birthdate` — дата рождения.  
   - `tg_nickname` — никнейм в Telegram (уникальный).  
   - `phone` — номер телефона (уникальный).

2. **`roles`**  
   Хранит список ролей, которые могут быть назначены пользователям.  
   Поля:  
   - `id` — уникальный идентификатор роли.  
   - `role_name` — название роли (например, "admin", "user").  

3. **`departments`**  
   Хранит список отделов.  
   Поля:  
   - `id` — уникальный идентификатор отдела.  
   - `department_name` — название отдела.

4. **`job_titles`**  
   Хранит список должностей.  
   Поля:  
   - `id` — уникальный идентификатор должности.  
   - `title` — название должности.

5. **`user_details`**  
   Хранит дополнительную информацию о пользователях.  
   Поля:  
   - `user_id` — идентификатор пользователя (foreign key на `users.id`).  
   - `interests` — интересы пользователя (в текстовом формате).  
   - `ncoins` — виртуальная валюта пользователя (по умолчанию 0).  
   - `rating` — рейтинг пользователя (по умолчанию 0).  
   - `thanks_count` — количество благодарностей (по умолчанию 0).  
   - `command_info` — текстовая информация о команде.  

6. **`user_photos`**  
   Хранит фото пользователей.  
   Поля:  
   - `user_id` — идентификатор пользователя (foreign key на `users.id`).  
   - `photo` — фото пользователя (в формате `BYTEA`).

### Связующие таблицы:

1. **`user_roles`**  
   Связывает пользователей с ролями.  
   Поля:  
   - `user_id` — идентификатор пользователя (foreign key на `users.id`).  
   - `role_id` — идентификатор роли (foreign key на `roles.id`).  

2. **`user_departments`**  
   Связывает пользователей с отделами.  
   Поля:  
   - `user_id` — идентификатор пользователя (foreign key на `users.id`).  
   - `department_id` — идентификатор отдела (foreign key на `departments.id`).  

3. **`user_job_titles`**  
   Связывает пользователей с должностями.  
   Поля:  
   - `user_id` — идентификатор пользователя (foreign key на `users.id`).  
   - `job_title` — идентификатор должности (foreign key на `job_titles.id`).  

---

## Установка базы данных

# Вручную

1. Убедитесь, что у вас установлен PostgreSQL.
2. Создайте новую базу данных командой:
   ```bash
   createdb gami_db
   ```
3. Примените скрипт инициализации базы данных:
   ```bash
   psql -U postgres -d gami_db -f initdb.sql
   ```
# Docker

1. Убедитесь, что у вас установлен Docker.
2. Создайте новую базу данных командой в директории с docker-compose.yml:
   ```bash
   docker-compose up -d
   ```
   
---

## Примеры использования

### 1. Добавление нового пользователя
```sql
INSERT INTO users (login, password, name, surname, birthdate, tg_nickname, phone)
VALUES ('jdoe', 'hashed_password', 'John', 'Doe', '1990-01-01', '@johndoe', '+123456789');
```

### 2. Назначение роли пользователю
```sql
INSERT INTO user_roles (user_id, role_id)
VALUES (1, 2); -- где 1 — это ID пользователя, а 2 — ID роли
```

### 3. Добавление интересов пользователю
```sql
UPDATE user_details
SET interests = '["coding", "sports", "music"]'
WHERE user_id = 1;
```

### 4. Добавление фото пользователю
```sql
INSERT INTO user_photos (user_id, photo)
VALUES (1, E'\\x0102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f');
```


# PGAdmin

Для работы с базой данных можно использовать [PGAdmin](http://127.0.0.1:5050).